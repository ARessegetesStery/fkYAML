if(MSVC)
  if(CMAKE_CXX_FLAGS MATCHES "/W[0-4]")
    string(REGEX REPLACE "/W[0-4]" "/W4" CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS}")
  else()
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} /W4")
  endif()
  set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} /EHsc /utf-8 /permissive-")
  set(CMAKE_CXX_FLAGS_DEBUG "${CMAKE_CXX_FLAGS_DEBUG} /Z7")
  set(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS_RELEASE} /Od")
else()
  set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall")
endif()
set(CMAKE_CXX_STANDARD 11)

add_sanitizer_flags(${FK_YAML_RunSanitizers})

set(TEST_TARGET "fkYAMLUnitTest")

add_executable(${TEST_TARGET}
  DeserializerTest.cpp
  LexicalAnalyzerTest.cpp
  NodeClassTest.cpp
  main.cpp
)

target_include_directories(${TEST_TARGET} PRIVATE
  ${PROJECT_SOURCE_DIR}/include
  ${CMAKE_CURRENT_SOURCE_DIR}
)

function(add_unit_test CLASS_NAME FUNC_NAME TARGET_NAME ID)
  set(TEST_NAME ${CLASS_NAME}_${FUNC_NAME})
  add_test(NAME ${TEST_NAME} COMMAND $<TARGET_FILE:${TARGET_NAME}> ${ID})
  set_tests_properties(${TEST_NAME} PROPERTIES LABELS ${CLASS_NAME})
endfunction()

add_unit_test(NodeClassTest DefaultCtorTest                        ${TEST_TARGET} 0x0000)
add_unit_test(NodeClassTest SequenceTypeCtorTest                   ${TEST_TARGET} 0x0001)
add_unit_test(NodeClassTest MappingTypeCtorTest                    ${TEST_TARGET} 0x0002)
add_unit_test(NodeClassTest NullTypeCtorTest                       ${TEST_TARGET} 0x0003)
add_unit_test(NodeClassTest BooleanTypeCtorTest                    ${TEST_TARGET} 0x0004)
add_unit_test(NodeClassTest SignedIntTypeCtorTest                  ${TEST_TARGET} 0x0005)
add_unit_test(NodeClassTest UnsignedIntTypeCtorTest                ${TEST_TARGET} 0x0006)
add_unit_test(NodeClassTest FloatNumberTypeCtorTest                ${TEST_TARGET} 0x0007)
add_unit_test(NodeClassTest StringTypeCtorTest                     ${TEST_TARGET} 0x0008)
add_unit_test(NodeClassTest EmptySequenceNodeFactoryTest           ${TEST_TARGET} 0x0009)
add_unit_test(NodeClassTest LvalueSequenceNodeFactoryTest          ${TEST_TARGET} 0x000A)
add_unit_test(NodeClassTest RvalueSequenceNodeFactoryTest          ${TEST_TARGET} 0x000B)
add_unit_test(NodeClassTest EmptyMappingNodeFactoryTest            ${TEST_TARGET} 0x000C)
add_unit_test(NodeClassTest LvalueMappingNodeFactoryTest           ${TEST_TARGET} 0x000D)
add_unit_test(NodeClassTest RvalueMappingNodeFactoryTest           ${TEST_TARGET} 0x000E)
add_unit_test(NodeClassTest BoolNodeFactoryTest                    ${TEST_TARGET} 0x000F)
add_unit_test(NodeClassTest SignedIntegerNodeFactoryTest           ${TEST_TARGET} 0x0010)
add_unit_test(NodeClassTest UnsignedIntegerNodeFactoryTest         ${TEST_TARGET} 0x0011)
add_unit_test(NodeClassTest FloatNumberNodeFactoryTest             ${TEST_TARGET} 0x0012)
add_unit_test(NodeClassTest EmptyStringNodeFactoryTest             ${TEST_TARGET} 0x0013)
add_unit_test(NodeClassTest LvalueStringNodeFactoryTest            ${TEST_TARGET} 0x0014)
add_unit_test(NodeClassTest RvalueStringNodeFactoryTest            ${TEST_TARGET} 0x0015)
add_unit_test(NodeClassTest AliasNodeFactoryTest                   ${TEST_TARGET} 0x0016)
add_unit_test(NodeClassTest AliasNodeFactoryThrowExceptionTest     ${TEST_TARGET} 0x0017)
add_unit_test(NodeClassTest LvalueStringSubscriptOperatorTest      ${TEST_TARGET} 0x0018)
add_unit_test(NodeClassTest ConstLvalueStringSubscriptOperatorTest ${TEST_TARGET} 0x0019)
add_unit_test(NodeClassTest RvalueStringSubscriptOperatorTest      ${TEST_TARGET} 0x001A)
add_unit_test(NodeClassTest ConstRvalueStringSubscriptOperatorTest ${TEST_TARGET} 0x001B)
add_unit_test(NodeClassTest IntegerSubscriptOperatorTest           ${TEST_TARGET} 0x001C)
add_unit_test(NodeClassTest ConstIntegerSubscriptOperatorTest      ${TEST_TARGET} 0x001D)
add_unit_test(NodeClassTest SequenceTypeTest                       ${TEST_TARGET} 0x001E)
add_unit_test(NodeClassTest SequenceAliasTypeTest                  ${TEST_TARGET} 0x001F)
add_unit_test(NodeClassTest MappingTypeTest                        ${TEST_TARGET} 0x0020)
add_unit_test(NodeClassTest MappingAliasTypeTest                   ${TEST_TARGET} 0x0021)
add_unit_test(NodeClassTest NullObjectTypeTest                     ${TEST_TARGET} 0x0022)
add_unit_test(NodeClassTest NullObjectAliasTypeTest                ${TEST_TARGET} 0x0023)
add_unit_test(NodeClassTest BooleanTypeTest                        ${TEST_TARGET} 0x0024)
add_unit_test(NodeClassTest BooleanAliasTypeTest                   ${TEST_TARGET} 0x0025)
add_unit_test(NodeClassTest SignedIntegerTypeTest                  ${TEST_TARGET} 0x0026)
add_unit_test(NodeClassTest SignedIntegerAliasTypeTest             ${TEST_TARGET} 0x0027)
add_unit_test(NodeClassTest UnsignedIntegerTypeTest                ${TEST_TARGET} 0x0028)
add_unit_test(NodeClassTest UnsignedIntegerAliasTypeTest           ${TEST_TARGET} 0x0029)
add_unit_test(NodeClassTest FloatNumberTypeTest                    ${TEST_TARGET} 0x002A)
add_unit_test(NodeClassTest FloatNumberAliasTypeTest               ${TEST_TARGET} 0x002B)
add_unit_test(NodeClassTest StringTypeTest                         ${TEST_TARGET} 0x002C)
add_unit_test(NodeClassTest StringAliasTypeTest                    ${TEST_TARGET} 0x002D)
add_unit_test(NodeClassTest IsSequenceTest                         ${TEST_TARGET} 0x002E)
add_unit_test(NodeClassTest IsSequenceAliasTest                    ${TEST_TARGET} 0x002F)
add_unit_test(NodeClassTest IsMappingTest                          ${TEST_TARGET} 0x0030)
add_unit_test(NodeClassTest IsMappingAliasTest                     ${TEST_TARGET} 0x0031)
add_unit_test(NodeClassTest IsNullTest                             ${TEST_TARGET} 0x0032)
add_unit_test(NodeClassTest IsNullAliasTest                        ${TEST_TARGET} 0x0033)
add_unit_test(NodeClassTest IsBooleanTest                          ${TEST_TARGET} 0x0034)
add_unit_test(NodeClassTest IsBooleanAliasTest                     ${TEST_TARGET} 0x0035)
add_unit_test(NodeClassTest IsSignedIntegerTest                    ${TEST_TARGET} 0x0036)
add_unit_test(NodeClassTest IsSignedIntegerAliasTest               ${TEST_TARGET} 0x0037)
add_unit_test(NodeClassTest IsUnsignedIntegerTest                  ${TEST_TARGET} 0x0038)
add_unit_test(NodeClassTest IsUnsignedIntegerAliasTest             ${TEST_TARGET} 0x0039)
add_unit_test(NodeClassTest IsFloatNumberTest                      ${TEST_TARGET} 0x003A)
add_unit_test(NodeClassTest IsFloatNumberAliasTest                 ${TEST_TARGET} 0x003B)
add_unit_test(NodeClassTest IsStringTest                           ${TEST_TARGET} 0x003C)
add_unit_test(NodeClassTest IsStringAliasTest                      ${TEST_TARGET} 0x003D)
add_unit_test(NodeClassTest IsScalarTest                           ${TEST_TARGET} 0x003E)
add_unit_test(NodeClassTest IsScalarAliasTest                      ${TEST_TARGET} 0x003F)
add_unit_test(NodeClassTest IsAliasTest                            ${TEST_TARGET} 0x0040)
add_unit_test(NodeClassTest SequenceIsEmptyTest                    ${TEST_TARGET} 0x0041)
add_unit_test(NodeClassTest SequenceAliasIsEmptyTest               ${TEST_TARGET} 0x0042)
add_unit_test(NodeClassTest MappingIsEmptyTest                     ${TEST_TARGET} 0x0043)
add_unit_test(NodeClassTest MappingAliasIsEmptyTest                ${TEST_TARGET} 0x0044)
add_unit_test(NodeClassTest StringIsEmptyTest                      ${TEST_TARGET} 0x0045)
add_unit_test(NodeClassTest StringAliasIsEmptyTest                 ${TEST_TARGET} 0x0046)
add_unit_test(NodeClassTest IsEmptyThrowExceptionTest              ${TEST_TARGET} 0x0047)
add_unit_test(NodeClassTest AliasIsEmptyThrowExceptionTest         ${TEST_TARGET} 0x0048)
add_unit_test(NodeClassTest SequenceSizeTest                       ${TEST_TARGET} 0x0049)
add_unit_test(NodeClassTest MappingSizeTest                        ${TEST_TARGET} 0x004A)
add_unit_test(NodeClassTest StringSizeTest                         ${TEST_TARGET} 0x004B)
add_unit_test(NodeClassTest SizeThrowExceptionTest                 ${TEST_TARGET} 0x004C)
add_unit_test(NodeClassTest HasAnchorNameTest                      ${TEST_TARGET} 0x004D)
add_unit_test(NodeClassTest GetAnchorNameTest                      ${TEST_TARGET} 0x004E)
add_unit_test(NodeClassTest FirstAddLvalueAnchorNameTest           ${TEST_TARGET} 0x004F)
add_unit_test(NodeClassTest FirstAddRvalueAnchorNameTest           ${TEST_TARGET} 0x0050)
add_unit_test(NodeClassTest TwiceAddLvalueAnchorNameTest           ${TEST_TARGET} 0x0051)
add_unit_test(NodeClassTest TwiceAddRvalueAnchorNameTest           ${TEST_TARGET} 0x0052)
add_unit_test(NodeClassTest ToSequenceTest                         ${TEST_TARGET} 0x0053)
add_unit_test(NodeClassTest ConstToSequenceTest                    ${TEST_TARGET} 0x0054)
add_unit_test(NodeClassTest ToSequenceThrowExceptionTest           ${TEST_TARGET} 0x0055)
add_unit_test(NodeClassTest ToMappingTest                          ${TEST_TARGET} 0x0056)
add_unit_test(NodeClassTest ConstToMappingTest                     ${TEST_TARGET} 0x0057)
add_unit_test(NodeClassTest ToMappingThrowExceptionTest            ${TEST_TARGET} 0x0058)
add_unit_test(NodeClassTest ToBooleanTest                          ${TEST_TARGET} 0x0059)
add_unit_test(NodeClassTest ConstToBooleanTest                     ${TEST_TARGET} 0x005A)
add_unit_test(NodeClassTest ToBooleanThrowExceptionTest            ${TEST_TARGET} 0x005B)
add_unit_test(NodeClassTest ToSignedIntegerTest                    ${TEST_TARGET} 0x005C)
add_unit_test(NodeClassTest ConstToSignedIntegerTest               ${TEST_TARGET} 0x005D)
add_unit_test(NodeClassTest ToSignedIntegerThrowExceptionTest      ${TEST_TARGET} 0x005E)
add_unit_test(NodeClassTest ToUnsignedIntegerTest                  ${TEST_TARGET} 0x005F)
add_unit_test(NodeClassTest ConstToUnsignedIntegerTest             ${TEST_TARGET} 0x0060)
add_unit_test(NodeClassTest ToUnsignedIntegerThrowExceptionTest    ${TEST_TARGET} 0x0061)
add_unit_test(NodeClassTest ToFloatNumberTest                      ${TEST_TARGET} 0x0062)
add_unit_test(NodeClassTest ConstToFloatNumberTest                 ${TEST_TARGET} 0x0063)
add_unit_test(NodeClassTest ToFloatNumberThrowExceptionTest        ${TEST_TARGET} 0x0064)
add_unit_test(NodeClassTest ToStringTest                           ${TEST_TARGET} 0x0065)
add_unit_test(NodeClassTest ConstToStringTest                      ${TEST_TARGET} 0x0066)
add_unit_test(NodeClassTest ToStringThrowExceptionTest             ${TEST_TARGET} 0x0067)
add_unit_test(NodeClassTest SwapTest                               ${TEST_TARGET} 0x0068)
add_unit_test(NodeClassTest StdSwapTest                            ${TEST_TARGET} 0x0069)
add_unit_test(NodeClassTest SequenceForLoopTest                    ${TEST_TARGET} 0x006A)
add_unit_test(NodeClassTest ConstSequenceForLoopTest               ${TEST_TARGET} 0x006B)

add_unit_test(LexicalAnalyzerTest ScanNullTest1                       ${TEST_TARGET} 0x0100)
add_unit_test(LexicalAnalyzerTest ScanNullTest2                       ${TEST_TARGET} 0x0101)
add_unit_test(LexicalAnalyzerTest ScanNullTest3                       ${TEST_TARGET} 0x0102)
add_unit_test(LexicalAnalyzerTest ScanNullTest4                       ${TEST_TARGET} 0x0103)
add_unit_test(LexicalAnalyzerTest ScanTrueBooleanTest1                ${TEST_TARGET} 0x0104)
add_unit_test(LexicalAnalyzerTest ScanTrueBooleanTest2                ${TEST_TARGET} 0x0105)
add_unit_test(LexicalAnalyzerTest ScanTrueBooleanTest3                ${TEST_TARGET} 0x0106)
add_unit_test(LexicalAnalyzerTest ScanFalseBooleanTest1               ${TEST_TARGET} 0x0107)
add_unit_test(LexicalAnalyzerTest ScanFalseBooleanTest2               ${TEST_TARGET} 0x0108)
add_unit_test(LexicalAnalyzerTest ScanFalseBooleanTest3               ${TEST_TARGET} 0x0109)
add_unit_test(LexicalAnalyzerTest ScanDecimalSignedIntegerTest        ${TEST_TARGET} 0x010A)
add_unit_test(LexicalAnalyzerTest ScanUnsignedDecimalIntegerTest      ${TEST_TARGET} 0x010B)
add_unit_test(LexicalAnalyzerTest ScanOctalIntegerTest                ${TEST_TARGET} 0x010C)
add_unit_test(LexicalAnalyzerTest ScanHexadecimalIntegerTest          ${TEST_TARGET} 0x010D)
add_unit_test(LexicalAnalyzerTest ScanSignedFloatNumberTest           ${TEST_TARGET} 0x010E)
add_unit_test(LexicalAnalyzerTest ScanUnsignedFloatNumberTest         ${TEST_TARGET} 0x010F)
add_unit_test(LexicalAnalyzerTest ScanFloatNumberWithExponentTest     ${TEST_TARGET} 0x0110)
add_unit_test(LexicalAnalyzerTest ScanPositiveInfinityTest1           ${TEST_TARGET} 0x0111)
add_unit_test(LexicalAnalyzerTest ScanPositiveInfinityTest2           ${TEST_TARGET} 0x0112)
add_unit_test(LexicalAnalyzerTest ScanPositiveInfinityTest3           ${TEST_TARGET} 0x0113)
add_unit_test(LexicalAnalyzerTest ScanNegativeInfinityTest1           ${TEST_TARGET} 0x0114)
add_unit_test(LexicalAnalyzerTest ScanNegativeInfinityTest2           ${TEST_TARGET} 0x0115)
add_unit_test(LexicalAnalyzerTest ScanNegativeInfinityTest3           ${TEST_TARGET} 0x0116)
add_unit_test(LexicalAnalyzerTest ScanNaNTest1                        ${TEST_TARGET} 0x0117)
add_unit_test(LexicalAnalyzerTest ScanNaNTest2                        ${TEST_TARGET} 0x0118)
add_unit_test(LexicalAnalyzerTest ScanNaNTest3                        ${TEST_TARGET} 0x0119)
add_unit_test(LexicalAnalyzerTest ScanDoubleQuotedEmptyStringTest     ${TEST_TARGET} 0x011A)
add_unit_test(LexicalAnalyzerTest ScanSingleQuotedEmptyStringTest     ${TEST_TARGET} 0x011B)
add_unit_test(LexicalAnalyzerTest ScanKeyBooleanValuePairTest         ${TEST_TARGET} 0x011C)
add_unit_test(LexicalAnalyzerTest ScanKeySignedIntegerValuePairTest   ${TEST_TARGET} 0x011D)
add_unit_test(LexicalAnalyzerTest ScanKeyUnsignedIntegerValuePairTest ${TEST_TARGET} 0x011E)
add_unit_test(LexicalAnalyzerTest ScanKeyFloatNumberValuePairTest     ${TEST_TARGET} 0x011F)
add_unit_test(LexicalAnalyzerTest ScanKeyStringValuePairTest          ${TEST_TARGET} 0x0120)
add_unit_test(LexicalAnalyzerTest ScanFlowSequenceObject1             ${TEST_TARGET} 0x0121)
add_unit_test(LexicalAnalyzerTest ScanFlowSequenceObject2             ${TEST_TARGET} 0x0122)
add_unit_test(LexicalAnalyzerTest ScanFlowMappingObject               ${TEST_TARGET} 0x0123)
add_unit_test(LexicalAnalyzerTest ScanBlockSequenceObject1            ${TEST_TARGET} 0x0124)
add_unit_test(LexicalAnalyzerTest ScanBlockSequenceObject2            ${TEST_TARGET} 0x0125)
add_unit_test(LexicalAnalyzerTest ScanBlockMappingObject1             ${TEST_TARGET} 0x0126)

add_unit_test(DeserializerTest DeserializeMappingObject1       ${TEST_TARGET} 0x0200)
add_unit_test(DeserializerTest DeserializeFlowSequenceObject1  ${TEST_TARGET} 0x0201)
add_unit_test(DeserializerTest DeserializeFlowMappingObject1   ${TEST_TARGET} 0x0202)
add_unit_test(DeserializerTest DeserializeBlockSequenceObject1 ${TEST_TARGET} 0x0203)
add_unit_test(DeserializerTest DeserializeBlockSequenceObject2 ${TEST_TARGET} 0x0204)
add_unit_test(DeserializerTest DeserializeBlockMappingObject1  ${TEST_TARGET} 0x0205)
